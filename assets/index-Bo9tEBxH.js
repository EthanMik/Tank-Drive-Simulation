(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const h=document.getElementById("canvas"),i=h.getContext("2d"),u=4,M=144*u,W=144*u;h.width=M;h.height=W;const $=1.5,D=96;function d(t){return t/(M/u/($*u))*D}function C(t){return d(t+72)}function G(t){return d(72-t)}function q(t){return(t-90)*(Math.PI/180)}function X(t){return t*Math.PI/180}function j(t){return t*180/Math.PI}function f(t,e,r){return Math.max(e,Math.min(r,t))}function B(t){return(t%360+360)%360}function y(t,e){return Math.abs(t)<e?0:t}function H(t){var e=new Image;return e.src=t,e}class V{width;height;maxSpeed;trackWidth;x=0;y=0;angle=0;color;vL=0;vR=0;maxAccel;constructor(e,r,o,n,s){this.width=e,this.height=r,this.maxSpeed=o,this.trackWidth=n,this.maxAccel=s,this.color="#969696ff"}set_x(e){this.x=f(e,-72+this.width/2,72-this.width/2)}set_y(e){this.y=f(e,-72+this.height/2,72-this.height/2)}set_angle(e){this.angle=(e%360+360)%360}get_x(){return this.x}get_y(){return this.y}get_angle(){return this.angle}moveTowards(e,r,o){const n=r-e;return Math.abs(n)<=o?r:e+Math.sign(n)*o}tankDrive(e,r,o){const n=this.trackWidth,s=this.maxSpeed,c=f(e,-1,1),g=f(r,-1,1),P=c*s,R=g*s,_=this.maxAccel*o;this.vL=this.moveTowards(this.vL,P,_),this.vR=this.moveTowards(this.vR,R,_);const p=this.vL*12,v=this.vR*12,w=(v+p)/2,F=(p-v)/n,I=this.get_angle(),m=X(I),O=Math.sin(m),A=Math.cos(m),E=this.get_x()+w*O*o,N=this.get_y()+w*A*o,S=m+F*o;let x=j(S);x=B(x),this.set_x(E),this.set_y(N),this.set_angle(x)}draw_odom_data(){i.save(),i.font="20px Calibri",i.fillStyle="white",i.textBaseline="top",i.fillText(`Î¸: ${this.get_angle().toFixed(2)}`,20,20),i.fillText(`X: ${this.get_x().toFixed(2)}`,20,45),i.fillText(`Y: ${this.get_y().toFixed(2)}`,20,70),i.fillText(`vL: ${this.vL.toFixed(2)}`,20,95),i.fillText(`vR: ${this.vR.toFixed(2)}`,20,120),i.fillText(`a: ${this.maxAccel.toFixed(2)}`,20,145),i.restore()}draw_chassis(){i.save(),i.translate(C(this.x),G(this.y)),i.rotate(q(this.angle)),i.fillStyle=this.color,i.fillRect(-d(this.width)/2,-d(this.height)/2,d(this.width),d(this.height)),i.beginPath(),i.moveTo(0,0),i.lineTo(d(this.width)/2,0),i.strokeStyle="black",i.lineWidth=2,i.stroke(),i.restore()}render(){this.draw_chassis(),this.draw_odom_data()}}let l=null;window.addEventListener("gamepadconnected",t=>{l=t.gamepad.index});window.addEventListener("gamepaddisconnected",t=>{l===t.gamepad.index&&(l=null)});function Y(){const t=navigator.getGamepads?navigator.getGamepads():[];return t&&l!=null&&t[l]?t[l]:null}const a=Object.create(null),K=Object.create(null);document.addEventListener("keydown",t=>{a[t.key]=!0});document.addEventListener("keyup",t=>{a[t.key]=!1,K[t.key]=!1});let Z=H("./empty_field.png");function z(){i.drawImage(Z,0,0,h.width,h.height)}const L=.15;function J(t,e,r){const o=t.axes,n=y(-o[1],L),s=y(o[2],L);e.tankDrive(n+s,n-s,r)}function Q(t,e){const r=Y();if(r)return J(r,t,e);let o=0,n=0,s=0;a.w&&(o+=1),a.s&&(o-=1),a.d&&(n+=.5),a.a&&(n-=.5),a.q&&(s=-1),a.e&&(s=1),t.maxAccel+=s;const c=o+n,g=o-n;t.tankDrive(c,g,e)}let b=new V(14,14,6,16,30);function U(t){z(),b.render(),Q(b,t)}let k=0;const tt=60,et=1e3/tt;function T(t){let e=t-k;e>=et&&(k=t,U(e/1e3)),window.requestAnimationFrame(T)}T(0);
