(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();const l=document.getElementById("canvas"),s=l.getContext("2d"),f=4,w=144*f,S=144*f;l.width=w;l.height=S;const W=1.5,A=96;function c(t){return t/(w/f/(W*f))*A}function $(t){return c(t+72)}function C(t){return c(72-t)}function E(t){return(t-90)*(Math.PI/180)}function X(t){return t*Math.PI/180}function j(t){return t*180/Math.PI}function d(t,e,r){return Math.max(e,Math.min(r,t))}function q(t){return(t%360+360)%360}function B(t){var e=new Image;return e.src=t,e}class D{width;height;maxSpeed;trackWidth;x=0;y=0;angle=0;color;vL=0;vR=0;maxAccel;constructor(e,r,o,i,n){this.width=e,this.height=r,this.maxSpeed=o,this.trackWidth=i,this.maxAccel=n,this.color="#969696ff"}set_x(e){this.x=d(e,-72+this.width/2,72-this.width/2)}set_y(e){this.y=d(e,-72+this.height/2,72-this.height/2)}set_angle(e){this.angle=(e%360+360)%360}get_x(){return this.x}get_y(){return this.y}get_angle(){return this.angle}moveTowards(e,r,o){const i=r-e;return Math.abs(i)<=o?r:e+Math.sign(i)*o}tankDrive(e,r,o){const i=this.trackWidth,n=this.maxSpeed,h=d(e,-1,1),b=d(r,-1,1),k=h*n,M=b*n,_=this.maxAccel*o;this.vL=this.moveTowards(this.vL,k,_),this.vR=this.moveTowards(this.vR,M,_);const m=this.vL*12,x=this.vR*12,y=(x+m)/2,T=(m-x)/i,P=this.get_angle(),u=X(P),R=Math.sin(u),F=Math.cos(u),I=this.get_x()+y*R*o,O=this.get_y()+y*F*o,N=u+T*o;let g=j(N);g=q(g),this.set_x(I),this.set_y(O),this.set_angle(g)}draw_odom_data(){s.save(),s.font="20px Calibri",s.fillStyle="white",s.textBaseline="top",s.fillText(`Î¸: ${this.get_angle().toFixed(2)}`,20,20),s.fillText(`X: ${this.get_x().toFixed(2)}`,20,45),s.fillText(`Y: ${this.get_y().toFixed(2)}`,20,70),s.fillText(`vL: ${this.vL.toFixed(2)}`,20,95),s.fillText(`vR: ${this.vR.toFixed(2)}`,20,120),s.restore()}draw_chassis(){s.save(),s.translate($(this.x),C(this.y)),s.rotate(E(this.angle)),s.fillStyle=this.color,s.fillRect(-c(this.width)/2,-c(this.height)/2,c(this.width),c(this.height)),s.beginPath(),s.moveTo(0,0),s.lineTo(c(this.width)/2,0),s.strokeStyle="black",s.lineWidth=2,s.stroke(),s.restore()}render(){this.draw_chassis(),this.draw_odom_data()}}const a=Object.create(null),H=Object.create(null);document.addEventListener("keydown",t=>{a[t.key]=!0});document.addEventListener("keyup",t=>{a[t.key]=!1,H[t.key]=!1});let V=B("empty_field.png");function Y(){s.drawImage(V,0,0,l.width,l.height)}function K(t,e){let r=0,o=0;a.w&&(r+=1),a.s&&(r-=1),a.d&&(o+=.5),a.a&&(o-=.5);const i=r+o,n=r-o;t.tankDrive(i,n,e)}let v=new D(14,14,6,16,30);function z(t){Y(),v.render(),K(v,t)}let p=0;const G=60,J=1e3/G;function L(t){let e=t-p;e>=J&&(p=t,z(e/1e3)),window.requestAnimationFrame(L)}L(0);
